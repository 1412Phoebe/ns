# 分析路由器日志以实现ARP攻击的防御检测的具体实现

## 配置路由器  
* 将日志输出到syslogd接收软件，然后分析路由器日志信息 ，通常在接收13志信息中会看到类似   
  “Duplicateaddress 172．20．187．60nVlan10，sourcedbyOOeO．4c439．2eaa”，  
  这个MAC地址就是我们要找的攻击源的MAC地址。
* 编制几个Shell脚本  
  从上述信息中提取出这个MAC地址。利用linux操作系统中的net—snmp开源软件中的snmpwalk命令提取路由器ARP缓存表，如 “snmpwalk—vl—Cc—Cpublic192．168．10．1 1．3．6．1．2．1．3．1．1．2>／etc／ARP／arptable”其中一v1代表使用SNMP协议vl版本；
一cc是忽略OID值渐增的情况，后面的“1．3．6．1．2．1．3．1．1-2”就是路由器的ARP表的OID值一C表示设备的snmp可读的community值；我们将snmpwalk命令执行的结果定向到／etc／ARP／arptable这个文件中，得到类似如下格式的arptable文件：  
RFC1213-MIB：：atPhysAddress．1．1．2．6．2．16=Hex-STRING：005056   
 C00001   
 RFC12l3一MIB：：atPhysAddress．1．1．2．6．2．17=Hex—STRING：0O5O56   
  CO0O01   
   RFCl213一MIB：：atPhvsAddress．1．1．2．6．2．18：Hex—STRING：OH05056   
    C00o01   
* 定位和关闭ARP欺骗源MAC地址所在交换机端口  
  使用snmpwalk命令得到接人交换机的MAC—PORT对应表，如“snmpwalk—vl—Cc一 publicSip 1．3．6．1．2．1．17．4．3．1．2>／etc／MAC／mac—port“然后提取相应的MAC地址与上述第二步确定的ARP攻击源MAC地址相比较，如相同则抽取相应设备 IP地址和对应的端口，则可以使用 “snmpset—vl—CpublicSipifAdminStatus．Sport”命令关闭交换机 
* 被关闭端口信息以网页公告形式通知用户  
  从第三步得知了ARP欺骗攻击源所在交换机IP和端口后，根据已有的交换机端口和房间关系对应表，即可发布相关信息通知用户及时处理自己的机器，在用户处理完毕后，自动使用同样的snmpset命令开启相应房间交换机端口，ARP欺骗攻击病毒从发现检测到防御过程完成。
  
  
