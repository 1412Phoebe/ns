# SSL/TLS在Web部署中的安全问题总结

## 1. SSL/TLS 协议及其安全问题  

SSL 协议最早由 Netscape 公司设计，它基于可信第三 方 PI（即 CA）和密码技术实现通信的双向身份认证、 数据的保密性和完整性保护。TLS 是 IETF 在 SSL 基础上 设计的，尽管 TLS 比 SSL 设计更加安全，而且 SSL 协议从 2.0 到 3.0 都屡次发现安全缺陷，但是主流的览器和服务 器通常都同时支持 TLS 和 SSL，主要是为了向后兼容。直 到 2014 年发现的 POODLE 攻击，SSL3.0 才被主流览 器停止使用了。 

除了实现中的（如Heart Bleed）以外，近年来发现的TLS协议本身的问题包括以下几类：

（1）弱密码 算法、短密和随机数问题，如TLS仍然支持MD5算 法、RC4、DES 等算法、以及 512 位的 RSA 密等；  
（2）Oracle类型的攻击，即通过比较输出密文可以知道输入的明 文是否正确，比如利用密码分组链（CBC）初始化向量构造 的BEAST攻击、利用选构造的CRIME攻击等；  
（3）协议或密码级攻击，主动攻击者可以在协议协商过程中 让客户端和服务器选最弱的密码算法或者最低的协议版本（如 SSL2.0 或 TLS1.0）。

## 2. 信任模和 PKI 的问题
SSL/TLS的安全建立在根CA必须安全可信的基础上。 主流览器或操作系统商在客户端预了数百个根CA 的证书，这些根 CA 及其子 CA 所签发的所有证书都被认 为是可信的。 不幸的是，根 CA 并非绝对可靠。一方面，多数 CA 为了提高效率和利，多数证书的签发过程是自动的 , 因 而对请者于验证；另一方面，如果任何一个根 CA 被攻破或者故意签发证书，都可被用来造任何网站。事实上，VeriSign、Comodo、DigiNotor 等都曾签发过证书。 在证书方面，传统的证书列表（CRL）分发存在很大延迟，软件商不得不依赖更新机制来分发 CRL。既便是实时的在线证书状态验证协议（OCSP）也存在很多问题，Google 的 Chrome 览器甚至关闭了 OCSP，开发了专有的机制 CRLset，收集所有 CA 的 CRL 推到用户览器。然而，目前这种机制并不被其他浏览器支持。  

## 3. HTTP 和 HTTPS 合部的问题
出于性能的考虑，多数网站或 Web 应用在实际环境 中常采用混合部署的方式——利用 HTTPS 来试保护敏感的信息，而非敏感信息则仍通过 HTTP 进行传输，这种混合部署会带来一系列的安全问题。对混合部署最容易的攻击是通过HTTP向HTTPS注入攻击 。Web 开发者容易犯的错误是在 HTTPS 面中 使用 HTTP 协议引用 JavaScript 本，攻击者就可以通过 明文的HTTP协议向HTTPS面中注入恶意代码，从而绕过HTTPS的防护，读取到览器中解密后的敏感信息。 混合部署另一个严重的问题是Cookie的保密性和完整性难以保证。Cookie 通常用于存储认证和会话管理等重要的信息，在览器与服务器之间按照同源策略（SOP） 进行传输。Cookie 的 SOP 由 Domain 和 Path 属性确定而 与协议无关，于是 HTTPS 会话中的 Cookie 有可能在 HTTP 会话中被露。为此，RFC 为 Cookie 定义了 Secure 属性， 具有该属性的 Cookie 只能通过 HTTPS 传输。然而，Secure 属性能保证 Cookie 的机密性而无法保证其完整性，攻 击者可以通过 Cookie Forcing 来改 Secure Cookie，结合 Cookie Tossing 等技巧，可以在 HTTPS 下进行 Session Fixation 、Authenticated-as-Attacker 等攻击。

## 4. CDN 部署 HTTPS 的问题

内容分发网络（CDN）通过缓存服务器来提高 Web 应用的性能和安全性，但是这给 Web 应用中 HTTPS 的 部署带来了新的问题。 HTTPS 基于端到端通信模型，能够保护用户与 Web 应用之间通信的安全。然而，CDN 在用户和 Web 应用 之间入了缓存服务器，把原来的端到端的通信分成两段：用户与缓存服务器之间的前端通信以及缓存服务器 与 Web 源服务器之间的后端通信。因此，CDN 环境下的 HTTPS 需要同时保证这两段通信的安全。 后端的安全通信包含缓存服务器与 Web 应用双方的认证交互，因此需要且需要标准 HTTPS 即可实现。前端的安全通信涉及用户对 Web 应用到 CDN 授权的验证以及对缓存服务器和 Web 应用的认证，标准 HTTPS 并不支持三方授权和认证的语义，因此会导致前端通信认证失。 当前工业界使用 Custom Cert 和 Shared Cert 两种折衷方案 来解决前端认证问题，但是这两种方案都存在各种各样的缺陷。


## 5. 防范与未来发展

上述诸多安全问题的解决需要长期的努力、多方的参 与，包括标准的制定组织（如IETF、W3C等）、软件商、 Web 应用开发者和安全研究人员等。 

(1) 在标准方面，IETF 已经通过了标准禁止使用有 安全缺陷的 SSL2.013，多个览器商有可能进一步通过 标准不再使用 SSL3.0。   

(2) 在信任模型方面，为了防止 CA 滥用信任造 证书，IETF 成立了 DANE 工作组且制定了 TLSA 标准，网站所有者通过 DNSSec 保护的资源记录指定本网站 信任的 CA 或证书。IETF 还在讨论另一所谓的密定 （Key Pinning）技术的草案，浏览器在一段时间内绑定某网站的证书，以防止中间人利用伪造的证书发起中间人攻击。   

(3) 在 HTTP 和 HTTPS 部署方面，为了防止 SSL Strip 类型的中间人攻击，IETF 通过了 HSTS，通过新增 加的 STS Header 或预的网站列表，强制览器只能通过 HTTPS 进行访问，从而减少了攻击面。 
(4) 在 CDN 部署方面，为了解决授权认证问题，清华大学段海新教授的团队提出了基于 DANE 协议扩展的解决方案；CloudFlare 公司近 期发布的 Keyless 产品则试通过修改 CDN 端的 SSL/TLS 协 议的交互方式来完成 Web 应用对 CDN 授权的认证。   

然而，新技术的研究开发和部署过程是长的、渐进 的，在此过程中仍然存在很多挑战。而且，新的应用模式、 新的攻击方法仍然会不断出现。因此，安全防范永远只能 是增加攻击的复杂度、风险，而无法彻消除，永远 是个军备竞赛的过程（Arm Race）。




