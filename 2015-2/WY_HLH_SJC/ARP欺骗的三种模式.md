# ARP欺骗的三种模式 #
ARP欺骗：攻击者在网络上侦测到一个ARP请求数据包，它伪装成被请求的IP地址的主机。
## 终端ARP缓存投毒  ##
   按照ARP协议的设计，为了减少网络上过多的ARP数据通信，一个主机即使收到的ARP应答并非自己请求得到的，它也会将其更新到自己的ARP缓存表中，这样，就造成了ARP欺骗的可能。
     
   如果黑客想要监听同一网络中两台主机之间的通信（即使是通过Switch相连）他会分别给这两台主机发送一个ARP应答包，让两台主机都误以为对方的MAC地址是第三方的黑客所在的主机。这样，双方看似直接在通信，实际上都是间接通过黑客所在的主机进行的。黑客一方面得到了想要的通信内容，一方面，只需要更改数据包的一些信息，成功的做好转发工作即可。

   已经处于这种嗅探方式的黑客所在主机是不需要设置网卡处于混杂模式的，因为通信双方的数据包都是发送给黑客所在的中转主机的。

   当然，因为ARP缓存表是动态更新的，其中动态生成的表项是有生命周期的，如果过了生命周期再没有新的信息更新，ARP映射项会自动去除。所以黑客还有一个任务是一直连续不断地向通信双方所在的主机发送虚假的ARP应答包，让其ARP缓存中一直保持被毒害的ARP表项。
     
   除了发送ARP应答包之外,黑客还可以通过发送Gratuitous ARP对通信双方所在主机的ARP高速缓存进行更新。
     
   总之，ARP缓存中毒其实就是攻击者使用ARP欺骗将伪值放入受害者的ARP高速缓存中。黑客可以利用终端ARP缓存投毒对网络中的两台主机的通信进行主动嗅探、中间人攻击。
   
## 交换机DoS ##

对于共享式（Hub）网络环境，在同一个网段的所有网卡都有访问在物理媒体上传输的所有数据的能力，而每一个网卡都有一个硬件地址，该硬件地址不同于网络中存在的其他网卡的硬件地址，同时，每个网络还有一个广播地址。当网络数据包的目标MAC地址具有和网卡向匹配的地址，或数据包的目的MAC地址为广播地址时，网卡通过CPU产生一个硬件中断，该中断能引起C操作系统对数据包做进一步的处理。

网卡的默认工作模式只接收广播帧和发给自己的帧。如采用混杂模式，一个主机的网卡将接收同一网络内所有主机发送的数据包。这样就可以达到对网络通信流量进行监听和捕获的目的。

但是，在交换式（Switch）网络环境中，黑客只能捕获到目标MAC地址是自己的数据包或者广播数据包， 如果想要监听整个局域网的通信流量，则需要强制交换机进入共享式（Hub）模式。交换机Dos就是针对该需求的一种攻击方式。

交换机DoS攻击是指利用工具不断发送去往未知目的地的数据帧，且每个包的源地址不同，从而快速填满CAM表，或者让交换机相信是另一台设备发送过来的数据包。当交换机CAM表被填满后，交换机退化为集线器，进广播状态，使内网由交换式网络退化成共享式网络。此时，黑客又可以对网络进行监听。

## 交换机投毒 ##

交换机的CAM表，记录了Mac－Port信息。所谓欺骗交换机缓存，就是修改这张CAM表以达到欺骗交换机的目的！

比如现在有一个3端口的交换机，它的具体信息如下：

11-11-11-11-11-11（主机A的MAC地址）  -- port1；

22-22-22-22-22-22（主机B的MAC地址）  -- port2；

33-33-33-33-33-33（主机C的MAC地址）  -- port3；
  
现在位于port2的主机B（MAC地址为22-22-22-22-22-22）想要嗅探位于port1的主机A（MAC地址为11-11-11-11-11-11）。

主机A发送数据包给主机C之前，交换机的CAM表如下：

11-11-11-11-11-11（主机A的MAC地址）  -- port1，此时交换机尚且无主机C的记录。

嗅探者B不断地发送源MAC地址为33-33-33-33-33-33的数据包。此时，交换机收到这个包，发现表中没有关于MAC地址为33-33-33-33-33-33的记录，则更新CAM表。

更新后的交换机CAM表如下：

11-11-11-11-11-11  -- port1；
33-33-33-33-33-33  -- port2；
此时交换机尚且无主机C的真实记录。 

处于PORT 1的主机向主机C发送数据，在查询port 2时，发现此端口对应MAC地址和数据包里的MAC地址相同，交换机直接就把包转发到处于port2的主机。

当嗅探者B已完成对A到C的通信嗅探，嗅探者B则发送ARP请求包，询问主机C的MAC地址。当交换机收到这个包，发现表中没有关于MAC地址为22-22-22-22-22-22的记录，则更新CAM表。

更新后的交换机CAM表如下：
11-11-11-11-11-11  -- port1；
22-22-22-22-22-22  -- port2；
此时交换机尚且无主机C的记录。 

当主机C接收到的ARP请求包时，会回复ARP应答包。交换机收到这个包，发现表中没有关于MAC地址为33-33-33-33-33-33的记录，则更新CAM表。

更新后的交换机CAM表如下：
11-11-11-11-11-11  -- port1；
22-22-22-22-22-22  -- port2；
33-33-33-33-33-33  -- port3； 

此时，嗅探者B把数据包还给主机C。通过以上主动“污染”交换机的MAC-Port转发表的攻击方式，黑客可以监听A->C的通信数据流量。
