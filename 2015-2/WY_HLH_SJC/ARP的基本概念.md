# ARP协议 #
ARP(Address Resolution Protocol,地址解析协议)是一种将IP转化成与IP对应的网卡的物理地址的一种协议。

在UDP/TCP网络环境下，一个IP包的走向依靠路由表定义。但是，当IP包到达该网络后，哪台计算机响应这个IP包却是靠该IP包含的MAC地址来识别的。所以需要借助ARP来将IP地址转换成MAC地址。

为了适应网络拓扑的动态变化并使ARP高速运行，每台主机上都要设置一个ARP高速缓存，用于存放最近IP地址到硬件地址之间的映射记录，并且要对高速缓存进行动态更新。通常，高速缓存中每项的生存时间是20min。

为了使所有的计算机共同认可地址解析消息的精确格式和含义，TCP/IP的地址解析协议ARP定义了两种基本的消息：ARP请求消息（一个请求消息包含一个IP地址和对相应硬件地址的请求）和ARP应答消息（一个应答消息既包含发来的IP地址，也包含相应的硬件地址）。ARP规定：所以请求消息都直接封装在LAN帧中，广播给局域网中所有计算机，每台计算机收到请求消息之后都要检测其中的IP地址；与IP地址匹配的计算机即发出一个应答消息，而其他计算机则丢弃收到的请求，不发出任何应答。IP地址是32位的，而以太网地址是48位的。
#局域网网络环境
将LAN内主机连在一起的设备有Hub和Switch。hub是物理层的设备，它仅是简单地将接收到的数据广播到各个物理网线的接口，而不管这个封包的目的MAC地址是谁。所以在共享式（Hub）网络中，将网卡设置成混杂模式就能监听到流经整个局域网的数据包。Switch是链路层设备，它具有过滤帧的功能。当Switch收到一个帧时，并不是向所有的接口转发此帧，而是先检查此帧的目的MAC地址，然后再确定将该帧转发到哪一个接口。所以在交换式（Switch）网络中，只能监听到目标地址是本身的数据包和广播数据包。所以为了监听交换式网络的通信流量，需要采用ARP欺骗攻击。
#交换机的工作原理
交换机转发数据包依据的是CAM（Content Addressable Memory）表 
若从A发出的帧从接口x进入了某Switch，那么从这个接口出发沿相反方向一定可把一个帧传送到A。Switch每收到一个帧，就记下其源地址和进入Switch的接口，作为转发表中的一个项目。在建立转发表时是把帧首部中的源MAC地址写在“地址”这一栏的下面。在转发帧时，则是根据收到的帧首部中的目的MAC地址来转发的。这时就把在“地址”栏下面已经记下的源MAC地址当作目的MAV地址，而把记下的进入接口当作转发接口。
