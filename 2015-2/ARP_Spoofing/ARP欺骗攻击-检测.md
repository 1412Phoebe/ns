#检测终端ARP缓存投毒者#
###检测终端用户的ARP缓存表

通过arp -a 命令来发现异常ARP缓存记录,从而检测出攻击主机的MAC地址。

###发送ARP请求包
ARP请求报文中含有源主机的IP地址和MAC地址，以及目的主机的IP地址。当该报文通过广播方式到达目的主机时，目的主机会响应该请求，并返回ARP响应报文，从而元主机可以获取目的主机的MAC地址，同样目的主机也能够获得源主机的MAC地址。经过ARP协议解析IP地址之后，主机会在缓存中保存IP地址和MAC地址的映射条目，此后再进行数据交换时只要从缓存中读取映射条目即可。

因为工作于混杂模式的网卡会响应ARP请求数据包，且该网卡的操作系统内核会自动回应该ARP请求数据包。所以可以采用发送伪造的ARP请求包来检测该局域网中工作于混杂模式的网卡，从而定位该网卡所在的主机。伪造的ARP请求包应当设置正确的IP地址错误目的MAC地址。

目的MAC地址的设置可以参考如下设置：

- 对于不同的操作系统，对ARP广播包的处理方式有差异

   - 
虚假广播消息:

       **B47:**FF:FF:FF:FF:FF:FF:FF:FE 

       **B16:**FF:FF:00:00:00:00:00:00 

       **B8:**FF:00:00:00:00:00:00:00 

       **B4:**F0:00:00:00:00:00:00:00 

- 不同操作系统的内核过滤机制有差异

  - 
虚假组播消息:

       **Gr:**01:00:00:00:00:00:00:00 

       **M0:**01:00:5E:00:00:00:00:00 

       **M1:**01:00:5E:00:00:00:00:01

       **M2:**01:00:5E:00:00:00:00:02 

     **M3:**01:00:5E:00:00:00:00:03 

![](http://i.imgur.com/Tld1a9K.png)

正常模式：左侧 混杂模式：右侧

O合法响应,X非法响应,--无响应

正常情况下，网卡检测是不是广播地址要比较看收到的目标MAC地址是否等于ff：ff：ff：ff：ff：ff，是则认为是广播地址。工作于混杂模式时，网卡检测是不是广播地址只看收到的包的目的MAC地址的部分比特位的值，若符合条件则认为是广播地址，利用这点细微差别可以检测出工作于混杂模式的网卡。

Linux环境下，当混杂模式时，每个包都被传到了操作系统内核处理。在处理某些包时，只看IP地址时，而不看目的MAC地址。所以使用一个不存在的目的MAC，正确的IP地址，受影响的内核将会由于是混杂模式而处理它，并将之交给系统堆栈处理，从而实现检测。
  
#检测交换机DoS攻击

系统通过启用交换机的端口镜像，来检测交换机的出现异常行为的端口。异常行为如下：

-链路通信质量参数：丢包率/重传率
       
-未知MAC地址

#检测交换机投毒者

当同一个MAC地址反复被映射到不同物理端口，可视为交换机CAM表中存在异常更新记录。系统应当能检测出系统的异常更新行为。
