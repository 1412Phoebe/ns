# ARP缓存的查看和工作原理的研究
ARP全称为Address Resolution Protocol,称为地址解析协议，它工作在数据链路层，在本层和硬件接口联系，同时对上层提供服务。它的基本功能就是将网络层的IP地址映射为数据链路层的物理地址(MAC地址)。
在以太网中，由于以太网设备并不识别32位的IP地址，所以数据包的传送不是通过IP地址，而是通过48位MAC地址来完成的。也就是说，在以太网中，一台主机要和另一台主机进行直接通信，必须要知道目标主机的MAC地址。ARP协议用于将网络中的IP地址解析为MAC地址，以保证通信的顺利进行。
  每台主机都有一个ARP缓存表，用来存储IP地址和MAC地址的映
射关系。在windows操作系统中，在命令行窗口中，输入arp -a会出现类似于这样的条目:

![image](https://github.com/weiyi1024/github-tutorial/raw/master/查看ARP缓存.JPG)  

这就是电脑里存储的关于IP地址与MAC地址的对应关系，动态表示是临时存储在ARP缓存中的条目，过一段时间就会超时被删除。这样一来，如果电脑要和一台机器比如10.195.15.254通信的时候，它会首先去检查ARP缓存，查找是否有对应的ARP条目，如果没有，它就会给这个以太网络发ARP请求包广播询问10.195.15.254的对应MAC地址，当然，网络中每台电脑都会收到这个请求包，但是它们发现10.195.15.254并非自己，就不会做出相应，而10.195.15.254就会给电脑回复一个ARP应答包，告诉它的MAC地址是XX-XX-XX-XX-XX-XX，于是电脑的ARP缓存就会相应刷新，多了这么一条:
      10.195.15.254   XX一XX一XX一XX一XX一XX    动态
ARP缓存表会根据收到的ARP请求包或ARP应答包进行动态更新，而且ARP缓存表还采用了老化机制，在一段时间内如果表中的某一行没有使用，就会被删除，这样可以大大减少ARP缓存表的长度，加快查询速度。  
源主机在传输数据前，首先要对初始数据进行封装，在该过程中会把目的主机的IP地址和MAC地址封装进去。在通信的最初阶段，我们能够知道目的主机的IP地址，而MAC地址却是未知的。这时如果目的主机和源主机在同一个网段内，源主机会以第二层广播的方式发送ARP请求报文。ARP请求报文中含有源主机的IP地址和MAC地址，以及目的主机的IP地址。当该报文通过广播方式到达目的主机时，目的主机会响应该请求，并返回ARP响应报文，从而源主机可以获取目的主机的MAC地址，同样目的主机也能够获得源主机的MAC地址。如果目的主机和源主机地址不在同一个网段内，源主机发出的IP数据包会送到交换机的默认网关，而默认网关的MAC地址同样可以通过ARP协议获取。经过ARP协议解析IP地址之后，主机会在缓存中保存IP地址和MAC地址的映射条目，此后再进行数据交换时只要从缓存中读取映射条目即可。
