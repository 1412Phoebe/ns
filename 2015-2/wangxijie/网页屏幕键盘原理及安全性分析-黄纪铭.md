   网页屏幕键盘与物理键盘安全性分析

一、物理键盘
     由数字键、清除键、确认键、返回键、上翻键以及下翻键组成
    如图


![](http://i.imgur.com/ujrC07Y.png)

二、屏幕键盘
由数字键、字母键、退出键和确定键组成
如图

![](http://i.imgur.com/IRNCF2u.png)


三、物理键盘的安全性

物理键盘存在按键记录木马技术，这个木马用于记录物理键盘击键，通过“键盘钩子”截获物理键盘的按键消息得到用户的密码等敏感信息。由三个模块组成：主模块，负责在系统中安装一个全局“钩子”；“钩子”模块，负责将每次按键事件汇报给主模块，主模块得到“钩子”模块的汇报后，将所有的击键记录保存在一个文件中；FPT模块，当这个储存文件大小达到一定的时候，主模块启动FPT模块，把这个文件上传到一个FPT服务器，或者通过自身的邮件发送模块，发送到黑客的邮箱里。

四、屏幕键盘比之物理键盘的优点

屏幕键盘是通过软件实现的模拟键盘输入技术，通过在屏幕上显示按键图像，再由鼠标点击相应按键图像完成输入。对于大多数屏幕键盘来说，点击屏幕键盘不会产生物理按键消息。木马就无法通过“键盘钩子”技术拦截按键消息截获敏感信息。
另外，屏幕键盘为软件模拟实现，开发者在开发过程中可以加入自己的软件安全机制提高安全性。

五、屏幕键盘的安全性及防范措施
屏幕键盘同样存在安全隐患，有以下几点：
1、截屏及屏幕录像
       攻击者可以使用恶意代码，在用户每次点击软键盘的时候进行截屏，利用截屏的图像，得到用户的输入的敏感信息。
       防范方式：使用键盘布局动态变化技术
        屏幕录像技术与截屏技术无本质区别。

2、“鼠标钩子”
       屏幕键盘需要使用鼠标，因此攻击者同样可以通过“鼠标钩子”截获鼠标的点击位置信息，再通过窗口句柄等方式获得屏幕键盘位置及分布信息，结合鼠标点击位置信息可以截获输入的敏感信息。
       防范方式：屏幕键盘布局动态变化以及采取检查各种钩子的安全措施。

3、程序篡改
   屏幕键盘的本地程序文件或加载到内存的指令序列可以进行篡改，攻击者可以通过篡改程序流程拦截屏幕键盘输入的信息。
   防范方式：对屏幕键盘的本地程序文件或加载到内存的指令序列增加CRC校验。也可以使用压缩、加密、关键代码虚拟化等加壳技术保护屏幕键盘程序，这种方式能通过加大屏幕键盘程序的反汇编和跟踪调试难度，提高攻击者攻击难度。

4、内存嗅探
       屏幕键盘的操作可能会在内存中存有临时信息，对这些信息不加以加密保护，攻击者就可以通过内存搜索嗅探的方式截获屏幕键盘的输入。
       防范方式:对内存敏感信息加密处理
5、底层劫持
攻击者可以通过编写内核驱动程序劫持系统调用，从内核层截获屏幕键盘的输入。
防范方式：由于此方式难度较大，发生的可能性较小。对此可以安装内核级的驱动保护程序。


总结：
大多数的屏幕键盘都避免了物理键盘的按键消息劫持，能有效避免“按键钩子”，但屏幕键盘依旧存在一些诸如：“鼠标钩子”、内存嗅探等攻击。
考虑到用户体验以及开发难度问题，可以采取一些屏幕键盘防屏幕录像机制、增强屏幕键盘敏感数据的保护等措施加以防范。